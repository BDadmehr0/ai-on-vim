#!/bin/bash

# 1๏ธโฃ ูุณุฑ ุฑูพู ฺฉูููโุดุฏู ุฑุง ุฏุฑุงูุช ฺฉู
REPO_DIR="$(pwd)"  # ูุฑุถ ูโฺฉูู ูุตุจโฺฉููุฏู ุฏุฑ ุฑูพู ฺฉูููโุดุฏู ุงุฌุฑุง ูโุดูุฏ
PLUGIN_DIR="$HOME/.vim/pack/plugins/start/vim-ai"

rm -rf ~/.vim/pack/plugins/start/vim-ai

# 2๏ธโฃ ุจุฑุฑุณ ุงูฺฉู ุขุง ุฑูพู ูุฌูุฏ ุฏุงุฑุฏุ
if [ ! -d "$REPO_DIR/plugin" ] || [ ! -d "$REPO_DIR/python" ]; then
    echo "โ ุฎุทุง: ุจู ูุธุฑ ูโุฑุณุฏ ฺฉู ุงู ุงุณฺฉุฑูพุช ุฑุง ุฏุฑ ุฏุงุฑฺฉุชูุฑ ุงุดุชุจุงู ุงุฌุฑุง ฺฉุฑุฏูโุงุฏ."
    echo "๐ ูุทูุงู ุงุจุชุฏุง ุฑูพู ุฑุง ฺฉููู ฺฉุฑุฏู ู ุณูพุณ ุงู ุงุณฺฉุฑูพุช ุฑุง ุฏุฑ ููุงู ุฏุงุฑฺฉุชูุฑ ุงุฌุฑุง ฺฉูุฏ!"
    exit 1
fi

# 3๏ธโฃ ุงุฌุงุฏ ูุณุฑ ูพูุงฺฏู ุฏุฑ ูู
echo "๐ ุงุฌุงุฏ ูุณุฑ ูพูุงฺฏู ุฏุฑ: $PLUGIN_DIR"
mkdir -p "$PLUGIN_DIR"

# 4๏ธโฃ ฺฉูพ ฺฉุฑุฏู ูุงูโูุง ูพูุงฺฏู ุงุฒ ุฑูพู
echo "๐ฅ ฺฉูพ ฺฉุฑุฏู ูุงูโูุง ูพูุงฺฏู..."
cp -r "$REPO_DIR/plugin" "$PLUGIN_DIR"
cp -r "$REPO_DIR/python" "$PLUGIN_DIR"

# 5๏ธโฃ ูุตุจ ูุงุจุณุชฺฏโูุง ูพุงุชูู (ุฏุฑ ุตูุฑุช ูุงุฒ)
echo "๐ ุจุฑุฑุณ ูุตุจ OpenAI API..."
if ! python3 -c "import openai" &> /dev/null; then
    echo "๐ฆ ูุตุจ openai..."
    pip3 install openai --break-system-packages
else
    echo "โ OpenAI API ุงุฒ ูุจู ูุตุจ ุดุฏู ุงุณุช."
fi

# 6๏ธโฃ ุจุฑุฑุณ ู ุงุถุงูู ฺฉุฑุฏู ุจู `vimrc`
VIMRC="$HOME/.vimrc"
if ! grep -q "packloadall" "$VIMRC"; then
    echo "๐ง ุงุถุงูู ฺฉุฑุฏู ูพูุงฺฏู ุจู vimrc..."
    echo 'packloadall' >> "$VIMRC"
    echo "source $PLUGIN_DIR/plugin/ai.vim" >> "$VIMRC"
fi

# 7๏ธโฃ ูพุงู ููููุช
echo "๐ ูุตุจ ฺฉุงูู ุดุฏ! ุญุงูุง ูโุชูุงูุฏ ุฏุณุชูุฑุงุช ุฒุฑ ุฑุง ุฏุฑ Vim ุงุฌุฑุง ฺฉูุฏ:"
echo "๐น :AISetup  (ุจุฑุง ุชูุธู ูุฏู ู API Key)"
echo "๐น :AI ุณูุงู ุดูุง"

echo "โ ูุทูุงู Vim ุฑุง ูุฌุฏุฏุงู ุฑุงูโุงูุฏุงุฒ ฺฉูุฏ!"

